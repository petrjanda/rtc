/*! rtc - v0.0.0 - 2013-04-08 */var ConsoleSignaling=function(){};ConsoleSignaling.prototype={send:function(n){console.log(JSON.stringify(n))}};var PusherSignaling=function(){this.pusher=new Pusher("2cd60bc764bca119d7bd"),this.channel=this.pusher.subscribe("private-test")};PusherSignaling.prototype={send:function(n,e){this.channel.trigger("client-"+n,e)},subscribe:function(n,e){this.channel.bind("client-"+n,e)}};var RTCPeerConnection=function(n){this.signaling=n};RTCPeerConnection.prototype={connect:function(n){var e=this,t={iceServers:[{url:n}]};this._connection=new webkitRTCPeerConnection(t),this._connection.onicecandidate=function(n){e.signaling.send("candidate",n.candidate)},this._connection.onaddstream=function(n){webkitURL.createObjectURL(n.stream);var e=document.getElementById("remote");console.log(n.stream),console.log(window.URL.createObjectURL(n.stream)),e.src=window.URL.createObjectURL(n.stream)}},streamOffer:function(n){var e=this;this._connection.addStream(n),this._connection.createOffer(function(n){e._connection.setLocalDescription(n),e.signaling.send("offer",n)})},addStream:function(n){this._connection.addStream(n)},answer:function(n){var e=this;this._connection.setRemoteDescription(new RTCSessionDescription(n)),this._connection.createAnswer(function(n){e._connection.setLocalDescription(n),e.signaling.send("answer",n)})},addIceCandidate:function(n){var n={sdpMLineIndex:n.sdpMLineIndex,candidate:n.candidate};console.log(n);var e=new RTCIceCandidate(n);this._connection.addIceCandidate(e)},answered:function(n){this._connection.setRemoteDescription(new RTCSessionDescription(n))}};var UserMedia=function(){};UserMedia.prototype={isSupported:function(){return!!(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia)},get:function(n,e,t){n=n||{video:!0,audio:!0},t=t||function(){},navigator.webkitGetUserMedia(n,e,t)}};var VideoCall=function(){var n=this;this.signaling=new PusherSignaling,this.rtc=new RTCPeerConnection(this.signaling),this.media=new UserMedia,this.rtc.connect("stun:stun.l.google.com:19302"),this.signaling.subscribe("offer",function(e){n.answer(e)}),this.signaling.subscribe("answer",function(e){n.rtc.answered(e)}),this.signaling.subscribe("candidate",function(e){n.rtc.addIceCandidate(e)})};VideoCall.prototype={call:function(){var n=this;this.media.get({video:!0},function(e){$("#call").hide(),n.onSuccess(e)})},answer:function(n){var e=this;this.media.get({video:!0},function(t){var i=document.getElementById("local");i.src=window.URL.createObjectURL(t),$("#call").hide(),e.rtc.addStream(t),e.rtc.answer(n)})},onSuccess:function(n){var e=document.getElementById("local");e.src=window.URL.createObjectURL(n),this.rtc.streamOffer(n)}};